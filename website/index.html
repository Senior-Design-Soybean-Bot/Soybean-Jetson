<!DOCTYPE html>
<html>
<head>
    <title>System Status</title>
    <script src="roslib.min.js"></script>
</head>
<body>
    <h1>System Status</h1>

    <h2>ROS Bridge:</h2>
    <div id="rosbridge-status">Disconnected</div>

    <h2>Controller:</h2>
    <div id="controller-status">Disconnected</div>

    <div>
        <h2>Controller Data</h2>
        <h3>Left Stick</h3>
        <div>X: <span id="left-x">0</span></div>
        <div>Y: <span id="left-y">0</span></div>

        <h3>Right Stick</h3>
        <div>X: <span id="right-x">0</span></div>
        <div>Y: <span id="right-y">0</span></div>
        <div id="controller-message">Waiting for input...</div>
    </div>

    <div>
        <h2>GPS Coordinates</h2>
        <div>Latitude: <span id="latitude">--</span></div>
        <div>Longitude: <span id="longitude">--</span></div>
        <div>Altitude: <span id="altitude">--</span></div>
    </div>

    <div>
        <h2>Camera Feeds</h2>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            try {
                const robotIP = '127.0.0.1';  // localhost
                const websocketPort = '9090';
                const websocketURL = `ws://${robotIP}:${websocketPort}`;

                console.log('Attempting connection to:', websocketURL);

                const ros = new ROSLIB.Ros({
                    url: websocketURL
                });

                ros.on('connection', () => {
                    document.getElementById('rosbridge-status').innerHTML = 'Connected';
                    console.log('Connected to ROS');
                });

                ros.on('error', (error) => {
                    document.getElementById('rosbridge-status').innerHTML = 'Error connecting';
                    console.error('Error connecting to ROS:', error);
                });

                ros.on('close', () => {
                    document.getElementById('rosbridge-status').innerHTML = 'Disconnected';
                    console.log('Connection closed');
                    setTimeout(() => {
                        try {
                            ros.connect(websocketURL);
                        } catch(error) {
                            console.error('Reconnection error:', error);
                        }
                    }, 3000);
                });

            } catch (e) {
                console.error('Setup error:', e);
                document.getElementById('rosbridge-status').innerHTML = 'Setup error: ' + e.message;
            }
        });
    </script>
</body>
</html>
